<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SSC Vocabulary Flashcards - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            touch-action: pan-y;
        }
        
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            opacity: 0.9;
        }

        /* Top Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 10px 16px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            font-size: clamp(0.85rem, 2.5vw, 1rem);
            white-space: nowrap;
            min-height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-tab:hover, .nav-tab:active {
            background: rgba(255,255,255,0.3);
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-color: white;
        }

        .nav-tab .count {
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.85em;
            margin-left: 4px;
        }

        /* Filters */
        .filters {
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        @media (min-width: 768px) {
            .filters {
                padding: 25px;
                margin-bottom: 30px;
            }
        }

        .filter-section {
            margin-bottom: 15px;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-size: clamp(1rem, 3vw, 1.1rem);
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            flex: 0 1 auto;
            min-height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .filter-btn:hover, .filter-btn:active {
            background: #f0f0f0;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }

        .clear-filters {
            padding: 10px 20px;
            background: #f5576c;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: clamp(0.85rem, 2.5vw, 0.9rem);
            min-height: 42px;
        }

        .clear-filters:hover, .clear-filters:active {
            background: #e04558;
            transform: translateY(-2px);
        }

        /* Stats */
        .stats {
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 12px 15px;
            margin-bottom: 15px;
            color: white;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .stat-item {
            text-align: center;
            min-width: 70px;
        }

        .stat-value {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: bold;
        }

        .stat-label {
            font-size: clamp(0.75rem, 2.5vw, 0.9rem);
            opacity: 0.9;
        }

        /* Card Area */
        .flip-hint {
            text-align: center;
            color: white;
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            opacity: 0.8;
            margin-bottom: 12px;
        }

        .swipe-hint {
            text-align: center;
            color: white;
            font-size: clamp(0.8rem, 2.5vw, 0.95rem);
            opacity: 0.7;
            margin-bottom: 10px;
        }

        .card-area {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .card-container {
            perspective: 1000px;
            width: 100%;
            max-width: 600px;
            touch-action: manipulation;
            cursor: pointer;
        }

        .card {
            width: 100%;
            height: clamp(350px, 60vh, 450px);
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        @media (max-width: 480px) {
            .card {
                height: clamp(380px, 70vh, 500px);
            }
        }

        .card:active {
            opacity: 0.95;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.swiping {
            transition: none;
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        @media (min-width: 768px) {
            .card-face {
                padding: 40px;
                border-radius: 20px;
            }
        }
            text-align: center;
        }

        .card-front {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }

        .card-back {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            transform: rotateY(180deg);
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .card-back::-webkit-scrollbar {
            width: 8px;
        }
        
        .card-back::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .card-back::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.4);
            border-radius: 10px;
        }
        
        .card-back::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.6);
        }

        .card-badges {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 5px 10px;
            border-radius: 12px;
            font-size: clamp(0.65rem, 2vw, 0.75rem);
            font-weight: bold;
            text-transform: uppercase;
        }

        @media (min-width: 768px) {
            .badge {
                padding: 5px 12px;
                border-radius: 15px;
            }
        }

        .badge-exam {
            background: #667eea;
            color: white;
        }

        .badge-type {
            background: #43e97b;
            color: #2d3436;
        }

        .badge-status {
            background: #f39c12;
            color: white;
        }

        .badge-status.remembered {
            background: #27ae60;
        }

        .badge-status.not-remembered {
            background: #e74c3c;
        }

        .word {
            font-size: clamp(1.8rem, 6vw, 3rem);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            word-wrap: break-word;
        }

        .hint {
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            color: #34495e;
            font-style: italic;
        }

        .meaning-section {
            width: 100%;
            word-wrap: break-word;
            overflow-wrap: break-word;
            padding: 5px 0;
            max-height: calc(100% - 80px);
            overflow-y: visible;
        }

        .meaning-title {
            font-size: clamp(0.85rem, 3vw, 1rem);
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @media (min-width: 768px) {
            .meaning-title {
                letter-spacing: 2px;
                margin-bottom: 15px;
            }
        }

        .meaning {
            font-size: clamp(0.95rem, 3vw, 1.1rem);
            margin-bottom: 12px;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        @media (min-width: 768px) {
            .meaning {
                margin-bottom: 20px;
            }
        }

        .hindi {
            font-size: clamp(1.1rem, 3.5vw, 1.5rem);
            margin-bottom: 12px;
            font-weight: bold;
            padding: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        @media (min-width: 768px) {
            .hindi {
                padding: 15px;
                margin-bottom: 20px;
            }
        }

        .synonym {
            font-size: clamp(0.9rem, 2.8vw, 1.05rem);
            margin-top: 12px;
            padding: 10px;
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        @media (min-width: 768px) {
            .synonym {
                margin-top: 20px;
                padding: 15px;
            }
        }

        /* Remember Controls */
        .remember-controls {
            display: flex;
            gap: 15px;
            margin: 15px auto;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 600px;
        }

        @media (min-width: 768px) {
            .remember-controls {
                gap: 20px;
                margin: 20px auto;
            }
        }

        .remember-btn {
            width: clamp(55px, 15vw, 65px);
            height: clamp(55px, 15vw, 65px);
            border: none;
            border-radius: 50%;
            font-size: clamp(1.8rem, 5vw, 2.2rem);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-remember {
            background: #27ae60;
            color: white;
        }

        .btn-remember:hover, .btn-remember:active {
            background: #229954;
            transform: scale(1.1);
        }

        .btn-not-remember {
            background: #e74c3c;
            color: white;
        }

        .btn-not-remember:hover, .btn-not-remember:active {
            background: #c0392b;
            transform: scale(1.1);
        }

        /* Navigation Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        @media (min-width: 768px) {
            .controls {
                gap: 15px;
                margin-bottom: 20px;
            }
        }

        .btn {
            padding: 12px 24px;
            font-size: clamp(0.85rem, 2.5vw, 1.1rem);
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .btn {
                padding: 15px 30px;
                letter-spacing: 1px;
            }
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:disabled:hover, .btn:disabled:active {
            transform: none;
        }

        .btn-prev, .btn-next {
            background: white;
            color: #667eea;
            min-width: 120px;
        }

        @media (min-width: 768px) {
            .btn-prev, .btn-next {
                min-width: 140px;
            }
        }

        .btn-prev:hover, .btn-prev:active, .btn-next:hover, .btn-next:active {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-prev:disabled, .btn-next:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-shuffle {
            background: #f5576c;
            color: white;
            min-width: 120px;
        }

        @media (min-width: 768px) {
            .btn-shuffle {
                min-width: 140px;
            }
        }

        .btn-shuffle:hover, .btn-shuffle:active {
            background: #e04558;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-flip {
            background: #43e97b;
            color: white;
            min-width: 120px;
            font-weight: bold;
        }

        @media (min-width: 768px) {
            .btn-flip {
                min-width: 140px;
            }
        }

        .btn-flip:hover, .btn-flip:active {
            background: #38d66a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .no-results {
            text-align: center;
            color: white;
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            padding: 40px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        @media (min-width: 768px) {
            .no-results {
                padding: 60px 20px;
            }
        }
            }

            .remember-controls {
                gap: 15px;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Quiz History Section */
        .quiz-history-section {
            display: none !important;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .quiz-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .quiz-history-header h2 {
            color: #667eea;
            font-size: 1.8em;
        }

        .clear-history-btn {
            padding: 10px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .clear-history-btn:hover {
            background: #c0392b;
        }

        .history-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .history-item:hover {
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-date {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .history-score {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .history-stat {
            text-align: center;
        }

        .history-stat-value {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .history-stat-label {
            font-size: 0.85em;
            color: #7f8c8d;
        }

        .stat-correct { color: #27ae60; }
        .stat-wrong { color: #e74c3c; }
        .stat-skipped { color: #f39c12; }

        .no-history {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.1em;
        }

        /* Progress Indicator */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #43e97b);
            border-radius: 10px;
            transition: width 0.3s;
        }

        /* Options Display on Card Back */
        .options-display {
            margin-top: 20px;
            text-align: left;
            width: 100%;
        }

        .option-item {
            background: rgba(255,255,255,0.2);
            padding: 12px 15px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 1em;
            line-height: 1.6;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .option-item strong {
            color: white;
            font-weight: 600;
        }
        
        .option-item em {
            color: rgba(255,255,255,0.85);
            font-style: normal;
            font-size: 0.95em;
        }

        /* Quiz Mode Styles */
        .quiz-setup {
            display: none !important;
        }
            max-width: 800px;
            margin: 0 auto;
        }

        .quiz-header {
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            flex-wrap: wrap;
            gap: 10px;
        }

        @media (min-width: 768px) {
            .quiz-header {
                padding: 20px;
                margin-bottom: 30px;
                border-radius: 15px;
            }
        }

        .quiz-progress, .quiz-score {
            font-size: clamp(1rem, 3vw, 1.2rem);
            font-weight: bold;
            color: #667eea;
        }

        .quiz-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (min-width: 768px) {
            .quiz-card {
                padding: 40px;
                margin-bottom: 30px;
                border-radius: 20px;
            }
        }

        .quiz-word {
            font-size: clamp(1.8rem, 6vw, 3rem);
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            text-align: center;
            word-wrap: break-word;
        }

        @media (min-width: 768px) {
            .quiz-word {
                margin-bottom: 15px;
            }
        }

        .quiz-hint {
            font-size: clamp(0.95rem, 3vw, 1.1rem);
            color: #666;
            font-style: italic;
            text-align: center;
            margin-bottom: 20px;
            word-wrap: break-word;
        }

        @media (min-width: 768px) {
            .quiz-hint {
                margin-bottom: 30px;
            }
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        @media (min-width: 768px) {
            .quiz-options {
                gap: 15px;
            }
        }

        .quiz-option {
            padding: 15px;
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            text-align: left;
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
            min-height: 56px;
            display: flex;
            align-items: center;
        }

        @media (min-width: 768px) {
            .quiz-option {
                padding: 20px;
                border-radius: 12px;
                line-height: 1.6;
            }
        }

        .quiz-option:hover, .quiz-option:active {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .quiz-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .quiz-option.correct {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }

        .quiz-option.incorrect {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }

        .quiz-option:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            font-weight: bold;
            text-align: center;
        }

        @media (min-width: 768px) {
            .quiz-feedback {
                margin-top: 20px;
                padding: 20px;
                border-radius: 12px;
            }
        }

        .quiz-feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .quiz-feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .quiz-controls {
            text-align: center;
        }

        /* Comprehensive Responsive Styles */
        
        /* Small mobile devices (< 480px) */
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            
            .header h1 {
                font-size: 1.3rem;
                margin-bottom: 6px;
            }
            
            .header p {
                font-size: 0.85rem;
            }
            
            .nav-tabs {
                gap: 6px;
                margin-bottom: 12px;
            }
            
            .nav-tab {
                padding: 8px 12px;
                font-size: 0.8rem;
                min-height: 38px;
            }
            
            .filters {
                padding: 12px;
                margin-bottom: 15px;
            }
            
            .filter-label {
                font-size: 0.95rem;
                margin-bottom: 8px;
            }
            
            .filter-btn {
                padding: 8px 14px;
                font-size: 0.8rem;
                min-height: 40px;
            }
            
            .stats {
                padding: 10px 12px;
                gap: 8px;
            }
            
            .stat-item {
                min-width: 65px;
            }
            
            .card {
                min-height: 380px;
            }
            
            .card-face {
                padding: 18px;
            }
            
            .word {
                font-size: 1.8rem;
                margin-bottom: 12px;
            }
            
            .badge {
                padding: 4px 8px;
                font-size: 0.65rem;
            }
            
            .remember-btn {
                width: 52px;
                height: 52px;
                font-size: 1.6rem;
            }
            
            .btn {
                padding: 10px 18px;
                font-size: 0.8rem;
                min-height: 44px;
            }
            
            .quiz-word {
                font-size: 1.6rem;
            }

            .quiz-option {
                padding: 12px;
                font-size: 0.9rem;
                min-height: 56px;
            }

            .quiz-card {
                padding: 18px;
            }
            
            .quiz-header {
                padding: 15px;
                flex-direction: column;
                gap: 10px;
            }
            
            .history-item {
                padding: 15px;
            }
            
            .history-details {
                grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
                gap: 8px;
            }
        }
        
        /* Tablets and medium devices (481px - 767px) */
        @media (min-width: 481px) and (max-width: 767px) {
            .card {
                min-height: 420px;
            }
            
            .quiz-word {
                font-size: 2.2rem;
            }
        }
        
        /* Landscape mode on mobile */
        @media (max-height: 600px) and (orientation: landscape) {
            .card {
                min-height: 260px !important;
            }
            
            .header {
                margin-bottom: 12px;
            }
            
            .header h1 {
                font-size: 1.4rem;
                margin-bottom: 4px;
            }
            
            .header p {
                font-size: 0.85rem;
            }
            
            .stats {
                margin-bottom: 12px;
                padding: 10px 15px;
            }
            
            .card-face {
                padding: 15px;
            }
            
            .word {
                font-size: 1.5rem;
                margin-bottom: 8px;
            }
            
            .meaning {
                font-size: 1rem;
                margin-bottom: 10px;
            }
            
            .remember-controls {
                margin: 12px auto;
                gap: 12px;
            }
        }
        
        /* Large screens */
        @media (min-width: 1024px) {
            .card {
                min-height: 450px;
            }
            
            .quiz-card {
                max-width: 800px;
            }
        }
        
        /* Touch-friendly improvements for touch devices */
        @media (hover: none) and (pointer: coarse) {
            .btn, .filter-btn, .quiz-option {
                min-height: 48px;
            }
            
            .remember-btn {
                min-width: 56px;
                min-height: 56px;
            }
            
            .nav-btn {
                width: 56px;
                height: 56px;
            }
            
            /* Larger tap targets for better touch experience */
            .nav-tab {
                min-height: 44px;
            }
        }
        
        /* Force quiz results to show when needed */
        #quiz-results[style*="display: block"] {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        #quiz-question[style*="display: none"] {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö SSC Vocabulary Flashcards</h1>
            <p>Enhanced with Progress Tracking</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchMode('all')">
                üìö All Cards
            </button>
            <button class="nav-tab" onclick="switchMode('not-remembered')" id="not-remembered-tab">
                ‚ö†Ô∏è Not Remembered <span class="count" id="not-remembered-count">0</span>
            </button>
            <button class="nav-tab" onclick="switchMode('remembered')" id="remembered-tab">
                ‚úÖ Remembered <span class="count" id="remembered-count">0</span>
            </button>
            <button class="nav-tab" onclick="switchMode('quiz')" id="quiz-tab">
                üéØ Quiz Mode
            </button>
            <button class="nav-tab" onclick="switchMode('history')" id="history-tab">
                üìä History
            </button>
        </div>

        <!-- Filters -->
        <div class="filters" id="filters-section">
            <div class="filter-section">
                <div class="filter-label">
                    <span>üìã</span>
                    <span>Filter by Exam:</span>
                </div>
                <div class="filter-options" id="exam-filters"></div>
            </div>

            <div class="filter-section">
                <div class="filter-label">
                    <span>üéØ</span>
                    <span>Filter by Type:</span>
                </div>
                <div class="filter-options" id="type-filters"></div>
            </div>

            <div class="filter-section">
                <button class="clear-filters" onclick="clearFilters()">‚úï Clear All Filters</button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <!-- Stats -->
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="total-cards">0</div>
                <div class="stat-label">Total Cards</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="showing-cards">0</div>
                <div class="stat-label">Showing</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="current-position">0</div>
                <div class="stat-label">Current</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" style="color: #27ae60;" id="remembered-stat">0</div>
                <div class="stat-label">Remembered</div>
            </div>
        </div>

        <div id="card-display">
            <div class="flip-hint">
                üëÜ Tap/Click card to flip | üîÑ Use Flip button | üëá Swipe left/right to navigate
            </div>

            <div class="card-area">
                <div class="card-container" id="card-container">
                    <div class="card" id="card">
                        <div class="card-face card-front">
                            <div class="card-badges" id="badges-front">
                                <div>
                                    <span class="badge badge-exam" id="exam-badge-front"></span>
                                    <span class="badge badge-type" id="type-badge-front"></span>
                                </div>
                                <span class="badge badge-status" id="status-badge-front"></span>
                            </div>
                            <div class="word" id="word">Loading...</div>
                            <div class="hint">Click to see meaning</div>
                        </div>
                        <div class="card-face card-back">
                            <div class="card-badges" id="badges-back">
                                <div>
                                    <span class="badge badge-exam" id="exam-badge-back"></span>
                                    <span class="badge badge-type" id="type-badge-back"></span>
                                </div>
                                <span class="badge badge-status" id="status-badge-back"></span>
                            </div>
                            <div class="meaning-section">
                                <div class="meaning-title">Meaning</div>
                                <div class="meaning" id="meaning">...</div>
                                <div class="hindi" id="hindi">...</div>
                                <div class="synonym" id="synonym">...</div>
                                
                                <!-- 4 Options Display -->
                                <div class="options-display" id="options-display" style="display:none;">
                                    <div class="option-item" id="option-a">A) ...</div>
                                    <div class="option-item" id="option-b">B) ...</div>
                                    <div class="option-item" id="option-c">C) ...</div>
                                    <div class="option-item" id="option-d">D) ...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Remember Controls Below Card -->
            <div class="remember-controls">
                <button class="remember-btn btn-not-remember" onclick="markCard('not-remembered')" title="Not Remembered (Keyboard: N)">
                    ‚ùå
                </button>
                <button class="remember-btn btn-remember" onclick="markCard('remembered')" title="Remembered (Keyboard: Y)">
                    ‚úÖ
                </button>
            </div>

            <div class="controls">
                <button class="btn btn-prev" onclick="previousCard()">‚Üê Previous</button>
                <button class="btn btn-flip" onclick="flipCard()">üîÑ Flip</button>
                <button class="btn btn-shuffle" onclick="shuffleCards()">üîÄ Shuffle</button>
                <button class="btn btn-next" onclick="nextCard()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Quiz Mode Interface -->
        <div id="quiz-mode" class="hidden">
            <div class="quiz-setup" id="quiz-setup">
                <h2 style="color: white; text-align: center; margin-bottom: 30px;">üéØ Quiz Setup</h2>
                
                <div class="filters" style="margin-bottom: 30px;">
                    <div class="filter-section">
                        <div class="filter-label">
                            <span>üìã</span>
                            <span>Select Exam:</span>
                        </div>
                        <div class="filter-options" id="quiz-exam-filters"></div>
                    </div>

                    <div class="filter-section">
                        <div class="filter-label">
                            <span>üìù</span>
                            <span>Select Type:</span>
                        </div>
                        <div class="filter-options" id="quiz-type-filters"></div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);">
                        <div style="font-size: 1.1em; color: #666; margin-bottom: 10px;">Available Questions</div>
                        <div style="font-size: 3em; font-weight: bold; color: #667eea;" id="quiz-question-count">0</div>
                        <div style="font-size: 0.9em; color: #999; margin-top: 5px;" id="quiz-selection-hint">Select exam and type to see questions</div>
                    </div>
                    <button class="btn" id="start-quiz-btn" style="background: #43e97b; color: white; font-size: 1.3em; padding: 20px 50px;" onclick="startQuiz()" disabled>
                        üéØ Start Quiz
                    </button>
                </div>
            </div>

            <div class="quiz-question" id="quiz-question" style="display: none;">
                <div class="quiz-header">
                    <div class="quiz-progress">
                        Question <span id="quiz-current">1</span> of <span id="quiz-total">10</span>
                    </div>
                    <div class="quiz-score">
                        Score: <span id="quiz-score">0</span>/<span id="quiz-answered">0</span>
                    </div>
                </div>

                <div class="quiz-card">
                    <div class="quiz-word" id="quiz-word">Word</div>
                    <div class="quiz-hint" id="quiz-hint">Select the correct meaning</div>
                    
                    <div class="quiz-options" id="quiz-options">
                        <button class="quiz-option" onclick="selectAnswer(0)">Option A</button>
                        <button class="quiz-option" onclick="selectAnswer(1)">Option B</button>
                        <button class="quiz-option" onclick="selectAnswer(2)">Option C</button>
                        <button class="quiz-option" onclick="selectAnswer(3)">Option D</button>
                    </div>

                    <div class="quiz-feedback" id="quiz-feedback" style="display: none;"></div>
                </div>

                <div class="quiz-controls" style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn" onclick="previousQuizQuestion()" id="quiz-prev-btn" style="background: #95a5a6; color: white;">
                        ‚Üê Previous
                    </button>
                    <button class="btn" onclick="skipQuestion()" id="quiz-skip-btn" style="background: #f39c12; color: white;">
                        ‚è≠Ô∏è Skip
                    </button>
                    <button class="btn" onclick="nextQuizQuestion()" id="quiz-next-btn" style="background: #3498db; color: white;">
                        Next ‚Üí
                    </button>
                    <button class="btn" onclick="submitQuiz()" id="quiz-submit-btn" style="background: #f5576c; color: white;">
                        üìù Submit Quiz
                    </button>
                </div>
            </div>

            <div class="quiz-results" id="quiz-results" style="display: none;">
                <div style="background: white; border-radius: 20px; padding: 40px; text-align: center; max-width: 700px; margin: 0 auto;">
                    <h2 style="color: #667eea; margin-bottom: 20px;">üéâ Quiz Complete!</h2>
                    
                    <!-- Score Display -->
                    <div style="font-size: 3em; margin: 20px 0; color: #667eea;" id="quiz-final-score">0</div>
                    <div style="font-size: 1.2em; color: #666; margin-bottom: 10px;">
                        <span id="quiz-percentage">0%</span> Accuracy
                    </div>
                    
                    <!-- Detailed Analysis -->
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 30px 0; text-align: center;">
                        <div style="background: #d4edda; padding: 20px; border-radius: 10px;">
                            <div style="font-size: 2em; color: #27ae60; font-weight: bold;" id="quiz-correct-count">0</div>
                            <div style="color: #155724; font-size: 0.9em;">Correct (+2)</div>
                        </div>
                        <div style="background: #f8d7da; padding: 20px; border-radius: 10px;">
                            <div style="font-size: 2em; color: #e74c3c; font-weight: bold;" id="quiz-wrong-count">0</div>
                            <div style="color: #721c24; font-size: 0.9em;">Wrong (-0.5)</div>
                        </div>
                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px;">
                            <div style="font-size: 2em; color: #f39c12; font-weight: bold;" id="quiz-skipped-count">0</div>
                            <div style="color: #856404; font-size: 0.9em;">Skipped (0)</div>
                        </div>
                    </div>
                    
                    <!-- Detailed Question Review -->
                    <div id="quiz-review-section" style="margin: 30px 0; text-align: left;">
                        <h3 style="color: #667eea; text-align: center; margin-bottom: 20px; font-size: 1.5em;">üìä Detailed Analysis</h3>
                        <div id="quiz-review-list"></div>
                    </div>
                    
                    <button class="btn" style="background: #667eea; color: white; font-size: 1.2em; padding: 15px 40px;" onclick="restartQuiz()">
                        üîÑ Take Another Quiz
                    </button>
                    <button class="btn" style="background: #95a5a6; color: white; font-size: 1.2em; padding: 15px 40px; margin-left: 15px;" onclick="switchMode('all')">
                        üìö Back to Cards
                    </button>
                </div>
            </div>
        </div>

        <!-- Quiz History Section -->
        <div id="history-section" class="hidden">
            <div class="quiz-history-section">
                <div class="quiz-history-header">
                    <h2>üìä Quiz History</h2>
                    <button class="clear-history-btn" onclick="clearQuizHistory()">üóëÔ∏è Clear History</button>
                </div>
                <div id="history-container">
                    <div class="no-history">
                        üìù No quiz attempts yet. Complete a quiz to see your history here!
                    </div>
                </div>
            </div>
        </div>

        <div id="no-results" class="no-results hidden">
            <p>üòï No flashcards match your current selection</p>
            <p style="font-size: 0.8em; margin-top: 15px; opacity: 0.8;">Try selecting different filters or switch to "All Cards"</p>
        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); text-align: center; z-index: 10000;">
            <div style="font-size: 3em; margin-bottom: 15px;">üìö</div>
            <div style="font-size: 1.2em; font-weight: bold; color: #667eea; margin-bottom: 10px;">Loading Vocabulary...</div>
            <div style="font-size: 0.9em; color: #7f8c8d;">Reading data from vocab.html</div>
        </div>
    </div>

    <script>
        // ==================== DATA LOADING ====================
        // Vocabulary data will be loaded dynamically from vocab.html
        let vocabData = {
            items: [],
            exams: {}
        };

        // Function to load vocabulary from vocab.html
        async function loadVocabularyFromHTML() {
            const response = await fetch('vocab.html');
            const htmlText = await response.text();
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlText, 'text/html');
            
            const items = [];
            const exams = {
                'cgl': { name: 'SSC CGL (Combined Graduate Level)', count: 0 },
                'chsl': { name: 'SSC CHSL (10+2 Level)', count: 0 },
                'mts': { name: 'SSC MTS (Multi Tasking Staff)', count: 0 },
                'cpo': { name: 'SSC CPO (Central Police Organisation)', count: 0 },
                'gd': { name: 'SSC GD (General Duty Constable)', count: 0 },
                'steno': { name: 'SSC Stenographer (Grade C & D)', count: 0 },
                'je': { name: 'SSC JE (Junior Engineer)', count: 0 },
                'common': { name: 'Common (All SSC Exams)', count: 0 }
            };
            
            const examSections = doc.querySelectorAll('.exam-section');
            
            examSections.forEach(section => {
                let exam_code = 'common';
                if (section.classList.contains('exam-cgl')) exam_code = 'cgl';
                else if (section.classList.contains('exam-chsl')) exam_code = 'chsl';
                else if (section.classList.contains('exam-mts')) exam_code = 'mts';
                else if (section.classList.contains('exam-cpo')) exam_code = 'cpo';
                else if (section.classList.contains('exam-gd')) exam_code = 'gd';
                else if (section.classList.contains('exam-steno')) exam_code = 'steno';
                else if (section.classList.contains('exam-je')) exam_code = 'je';
                
                const exam_name = exams[exam_code].name;
                const questions = section.querySelectorAll('.q');
                
                questions.forEach(q => {
                    const word = q.querySelector('.q-word')?.textContent.trim() || '';
                    const hindiRaw = q.querySelector('.q-hindi')?.textContent || '';
                    const hindi = hindiRaw.replace(/^[-\s]+/, '').replace(/\s*\/.*$/, '').trim(); // Remove leading dash and everything after /
                    const englishRaw = q.querySelector('.q-eng')?.textContent || '';
                    const english = englishRaw.replace(/^[\s()]+/, '').replace(/[\s()]+$/, '').trim();
                    
                    let type = 'synonym'; // default
                    let synonym = '';
                    let synonym_hindi = '';
                    
                    // Find the option with checkmark
                    const opts = q.querySelectorAll('.opt');
                    opts.forEach(opt => {
                        const emTag = opt.querySelector('em');
                        if (emTag && emTag.textContent.includes('‚úì')) {
                            // Get the synonym from <strong> tag
                            const strongTag = opt.querySelector('strong');
                            if (strongTag) {
                                synonym = strongTag.textContent.trim();
                            }
                            
                            // Extract type from marker in <em> tag
                            const emText = emTag.textContent;
                            
                            // Detect type from markers: (s), (a), (i), (Idiom), (OWS), etc.
                            if (emText.includes('(s)')) {
                                type = 'synonym';
                            } else if (emText.includes('(a)')) {
                                type = 'antonym';
                            } else if (emText.includes('(i)') || emText.includes('(Idiom)')) {
                                type = 'idiom';
                            } else if (emText.includes('(OWS)')) {
                                type = 'one-word-substitute';
                            } else if (emText.includes('(p)') || emText.includes('(Phrase)')) {
                                type = 'phrase';
                            } else {
                                // Fallback: if word has spaces, likely an idiom
                                if (word.includes(' ')) {
                                    type = 'idiom';
                                }
                            }
                            
                            // Get the hindi from <em> tag, remove checkmark and markers
                            synonym_hindi = emText
                                .replace(/‚úì/g, '')
                                .replace(/\([saipOWS]+\)/gi, '') // Remove type markers
                                .replace(/\(.*?\)/g, '') // Remove any other parentheses
                                .trim();
                        }
                    });
                    
                    if (word && synonym) {
                        items.push({
                            word, hindi, english,
                            synonym, synonym_hindi,
                            exam_code, exam_name, type
                        });
                        exams[exam_code].count++;
                    }
                });
            });
            
            return { items, exams };
        }

        // Load vocabulary data on page load
        async function initializeVocabData() {
            const loadingEl = document.getElementById('loading-indicator');
            if (loadingEl) loadingEl.style.display = 'block';
            
            try {
                console.log('üîÑ Starting to load vocabulary...');
                vocabData = await loadVocabularyFromHTML();
                console.log(`‚úÖ Loaded ${vocabData.items.length} vocabulary items from vocab.html`);
                console.log('üìä Exam breakdown:', vocabData.exams);
                
                if (vocabData.items.length === 0) {
                    throw new Error('No vocabulary items were parsed! Check vocab.html structure.');
                }
                
                // Initialize the app now that data is loaded
                console.log('üéØ Calling loadProgress()...');
                loadProgress();
                console.log('üéØ Calling initializeFilters()...');
                initializeFilters();
                console.log('‚úÖ Initialization complete!');
                
            } catch (error) {
                console.error('‚ùå Error loading vocabulary:', error);
                alert('Failed to load vocabulary data. Please ensure vocab.html is in the same folder.\n\nError: ' + error.message);
            } finally {
                if (loadingEl) loadingEl.style.display = 'none';
            }
        }

        // Call when page loads
        window.addEventListener('DOMContentLoaded', initializeVocabData);

        // ==================== GLOBAL VARIABLES ====================
        let currentIndex = 0;
        let filteredCards = [];
        let activeExamFilters = new Set();
        let activeTypeFilters = new Set();
        let isShuffled = false;
        let currentMode = 'all'; // 'all', 'not-remembered', 'remembered', 'quiz'
        let cardStatus = {}; // Store remembered/not-remembered status

        // Quiz variables
        let quizCards = [];
        let quizCurrentIndex = 0;
        let quizScore = 0;
        let quizAnswered = 0;
        let quizExamFilters = new Set();
        let quizTypeFilters = new Set();
        let currentQuizAnswer = -1;
        let quizAnswers = []; // Track all answers: { questionIndex, correct, userAnswer, correctAnswer, skipped }
        let quizInProgress = false;
        let quizCorrectCount = 0;
        let quizWrongCount = 0;
        let quizSkippedCount = 0;

        const typeNames = {
            'synonym': 'Synonym',
            'antonym': 'Antonym',
            'one-word-substitute': 'One Word Substitute',
            'idiom': 'Idiom',
            'phrase': 'Phrase',
            'unknown': 'Other'
        };

        const examIcons = {
            'cgl': 'üéì',
            'chsl': 'üìñ',
            'mts': 'üìù',
            'cpo': 'üëÆ',
            'phase': '‚≠ê',
            'common': 'üåü'
        };

        // Load saved progress from localStorage
        function loadProgress() {
            const saved = localStorage.getItem('ssc_vocab_progress');
            if (saved) {
                try {
                    cardStatus = JSON.parse(saved);
                } catch (e) {
                    cardStatus = {};
                }
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            localStorage.setItem('ssc_vocab_progress', JSON.stringify(cardStatus));
            updateCounts();
        }

        // Get card unique ID
        function getCardId(card) {
            return `${card.word}_${card.exam_code}_${card.type}`;
        }

        // Mark card as remembered/not-remembered
        function markCard(status) {
            const card = filteredCards[currentIndex];
            const cardId = getCardId(card);

            if (status === 'reset') {
                delete cardStatus[cardId];
            } else {
                cardStatus[cardId] = status;
            }

            saveProgress();
            updateStatusBadge();
            
            // Check if the current card should be removed from the current view
            const shouldRemove = 
                (currentMode === 'not-remembered' && status !== 'not-remembered') ||
                (currentMode === 'remembered' && status !== 'remembered') ||
                (currentMode === 'not-remembered' && status === 'reset') ||
                (currentMode === 'remembered' && status === 'reset');
            
            if (shouldRemove) {
                // Remove from current view by reapplying filters
                const currentCard = filteredCards[currentIndex];
                applyFilters();
                
                // Try to show the same position, or previous if at end
                if (filteredCards.length > 0) {
                    const newIndex = Math.min(currentIndex, filteredCards.length - 1);
                    showCard(newIndex);
                }
            } else {
                // Just auto advance to next card
                setTimeout(() => {
                    if (currentIndex < filteredCards.length - 1) {
                        nextCard();
                    }
                }, 300);
            }
        }

        function updateCounts() {
            const remembered = Object.values(cardStatus).filter(s => s === 'remembered').length;
            const notRemembered = Object.values(cardStatus).filter(s => s === 'not-remembered').length;
            
            document.getElementById('remembered-count').textContent = remembered;
            document.getElementById('not-remembered-count').textContent = notRemembered;
            document.getElementById('remembered-stat').textContent = remembered;
            
            // Update progress bar
            const total = vocabData.items.length;
            const percentage = (remembered / total) * 100;
            document.getElementById('progress-fill').style.width = percentage + '%';
        }

        function switchMode(mode) {
            // Prevent switching if quiz is in progress (unless submitting)
            if (quizInProgress && mode !== 'quiz') {
                if (!confirm('Quiz is in progress! Do you want to submit and exit?')) {
                    return;
                }
                submitQuiz();
                return;
            }
            
            currentMode = mode;
            
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all sections first
            document.getElementById('card-display').style.display = 'none';
            document.getElementById('no-results').style.display = 'none';
            document.getElementById('filters-section').style.display = 'none';
            document.getElementById('quiz-mode').classList.add('hidden');
            document.getElementById('history-section').classList.add('hidden');
            
            if (mode === 'quiz') {
                // Show quiz mode
                document.getElementById('quiz-mode').classList.remove('hidden');
                document.getElementById('quiz-setup').style.display = 'block';
                document.getElementById('quiz-question').style.display = 'none';
                document.getElementById('quiz-results').style.display = 'none';
                initializeQuizFilters();
            } else if (mode === 'history') {
                // Show history section
                document.getElementById('history-section').classList.remove('hidden');
                loadQuizHistory();
            } else {
                // Show card display
                document.getElementById('card-display').style.display = 'block';
                
                // Show/hide filters based on mode
                if (mode === 'all') {
                    document.getElementById('filters-section').style.display = 'block';
                } else {
                    clearFilters();
                }
                
                applyFilters();
            }
        }

        function initializeFilters() {
            console.log('üìù initializeFilters() called');
            console.log('üìä vocabData.items.length:', vocabData.items.length);
            
            const examCounts = {};
            const typeCounts = {};

            vocabData.items.forEach(item => {
                examCounts[item.exam_code] = (examCounts[item.exam_code] || 0) + 1;
                typeCounts[item.type] = (typeCounts[item.type] || 0) + 1;
            });
            
            console.log('üìä Exam counts:', examCounts);
            console.log('üìä Type counts:', typeCounts);

            const examFiltersDiv = document.getElementById('exam-filters');
            const sortedExams = Object.entries(examCounts).sort((a, b) => b[1] - a[1]);
            
            sortedExams.forEach(([code, count]) => {
                const exam = vocabData.exams[code];
                if (exam) {
                    const btn = document.createElement('button');
                    btn.className = 'filter-btn';
                    btn.innerHTML = `${examIcons[code] || 'üìå'} ${exam.name.split('(')[0].trim()}<span style="opacity:0.7;font-size:0.85em;margin-left:5px">(${count})</span>`;
                    btn.onclick = () => toggleExamFilter(code, btn);
                    examFiltersDiv.appendChild(btn);
                }
            });

            const typeFiltersDiv = document.getElementById('type-filters');
            const sortedTypes = Object.entries(typeCounts).sort((a, b) => b[1] - a[1]);
            
            sortedTypes.forEach(([type, count]) => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                const displayName = typeNames[type] || type.charAt(0).toUpperCase() + type.slice(1);
                btn.innerHTML = `${displayName}<span style="opacity:0.7;font-size:0.85em;margin-left:5px">(${count})</span>`;
                btn.onclick = () => toggleTypeFilter(type, btn);
                typeFiltersDiv.appendChild(btn);
            });

            console.log('üéØ Calling applyFilters()...');
            applyFilters();
            console.log('‚úÖ initializeFilters() complete');
        }

        function toggleExamFilter(code, btn) {
            if (activeExamFilters.has(code)) {
                activeExamFilters.delete(code);
                btn.classList.remove('active');
            } else {
                activeExamFilters.add(code);
                btn.classList.add('active');
            }
            applyFilters();
        }

        function toggleTypeFilter(type, btn) {
            if (activeTypeFilters.has(type)) {
                activeTypeFilters.delete(type);
                btn.classList.remove('active');
            } else {
                activeTypeFilters.add(type);
                btn.classList.add('active');
            }
            applyFilters();
        }

        function clearFilters() {
            activeExamFilters.clear();
            activeTypeFilters.clear();
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            applyFilters();
        }

        function applyFilters() {
            console.log('üîç applyFilters() called');
            console.log('üìä vocabData.items.length:', vocabData.items.length);
            console.log('üéØ currentMode:', currentMode);
            console.log('üéØ activeExamFilters:', Array.from(activeExamFilters));
            console.log('üéØ activeTypeFilters:', Array.from(activeTypeFilters));
            
            filteredCards = vocabData.items.filter(item => {
                // Apply mode filter
                const cardId = getCardId(item);
                const status = cardStatus[cardId];
                
                if (currentMode === 'remembered' && status !== 'remembered') return false;
                if (currentMode === 'not-remembered' && status !== 'not-remembered') return false;
                
                // Apply exam/type filters (only in 'all' mode)
                if (currentMode === 'all') {
                    const examMatch = activeExamFilters.size === 0 || activeExamFilters.has(item.exam_code);
                    const typeMatch = activeTypeFilters.size === 0 || activeTypeFilters.has(item.type);
                    return examMatch && typeMatch;
                }
                
                return true;
            });
            
            console.log('‚úÖ filteredCards.length:', filteredCards.length);

            isShuffled = false;
            updateStats();
            
            if (filteredCards.length > 0) {
                console.log('‚úÖ Showing cards...');
                document.getElementById('card-display').classList.remove('hidden');
                document.getElementById('no-results').classList.add('hidden');
                showCard(0);
            } else {
                console.log('‚ö†Ô∏è No cards to show');
                document.getElementById('card-display').classList.add('hidden');
                document.getElementById('no-results').classList.remove('hidden');
            }
        }

        function updateStats() {
            document.getElementById('total-cards').textContent = vocabData.items.length;
            document.getElementById('showing-cards').textContent = filteredCards.length;
            updateCounts();
        }

        function updateStatusBadge() {
            const card = filteredCards[currentIndex];
            const cardId = getCardId(card);
            const status = cardStatus[cardId];
            
            ['front', 'back'].forEach(side => {
                const badge = document.getElementById(`status-badge-${side}`);
                badge.className = 'badge badge-status';
                
                if (status === 'remembered') {
                    badge.textContent = '‚úÖ Remembered';
                    badge.classList.add('remembered');
                } else if (status === 'not-remembered') {
                    badge.textContent = '‚ùå Not Remembered';
                    badge.classList.add('not-remembered');
                } else {
                    badge.textContent = '‚ö™ New';
                }
            });
        }

        function showCard(index) {
            if (filteredCards.length === 0) return;
            
            currentIndex = index;
            const card = filteredCards[index];
            
            document.getElementById('word').textContent = card.word;
            
            const examName = vocabData.exams[card.exam_code]?.name.split('(')[0].trim() || card.exam_code.toUpperCase();
            const typeDisplay = typeNames[card.type] || card.type.charAt(0).toUpperCase() + card.type.slice(1);
            
            ['front', 'back'].forEach(side => {
                document.getElementById(`exam-badge-${side}`).textContent = examName;
                document.getElementById(`type-badge-${side}`).textContent = typeDisplay;
            });
            
            document.getElementById('meaning').textContent = card.english;
            document.getElementById('hindi').textContent = card.hindi;
            
            let synonymText = '';
            if (card.synonym) {
                synonymText = '‚úì ' + card.synonym;
                if (card.synonym_hindi) {
                    synonymText += ' ‚Ä¢ ' + card.synonym_hindi;
                }
            }
            document.getElementById('synonym').textContent = synonymText;
            
            // Generate 4 MCQ options
            const options = generateOptions(card);
            const optionsDisplay = document.getElementById('options-display');
            if (options && options.length === 4) {
                const isCorrect = (opt) => opt.synonym === card.synonym;
                document.getElementById('option-a').innerHTML = `<b>A)</b> <strong>${options[0].synonym}</strong>${options[0].synonym_hindi ? ` ‚Äì <em>${options[0].synonym_hindi}</em>` : ''} ${isCorrect(options[0]) ? '‚úì' : ''}`;
                document.getElementById('option-b').innerHTML = `<b>B)</b> <strong>${options[1].synonym}</strong>${options[1].synonym_hindi ? ` ‚Äì <em>${options[1].synonym_hindi}</em>` : ''} ${isCorrect(options[1]) ? '‚úì' : ''}`;
                document.getElementById('option-c').innerHTML = `<b>C)</b> <strong>${options[2].synonym}</strong>${options[2].synonym_hindi ? ` ‚Äì <em>${options[2].synonym_hindi}</em>` : ''} ${isCorrect(options[2]) ? '‚úì' : ''}`;
                document.getElementById('option-d').innerHTML = `<b>D)</b> <strong>${options[3].synonym}</strong>${options[3].synonym_hindi ? ` ‚Äì <em>${options[3].synonym_hindi}</em>` : ''} ${isCorrect(options[3]) ? '‚úì' : ''}`;
                optionsDisplay.style.display = 'block';
            } else {
                optionsDisplay.style.display = 'none';
            }
            
            document.getElementById('current-position').textContent = `${index + 1}/${filteredCards.length}`;
            
            updateStatusBadge();
            
            // Unflip card
            document.getElementById('card').classList.remove('flipped');
        }

        function generateOptions(currentCard) {
            // Get all possible synonyms from other cards
            const allOptions = vocabData.items
                .filter(item => item.synonym && item.synonym !== currentCard.synonym)
                .map(item => ({
                    synonym: item.synonym,
                    synonym_hindi: item.synonym_hindi || ''
                }));
            
            if (allOptions.length < 3) return null;
            
            // Shuffle and pick 3 wrong options
            const shuffled = allOptions.sort(() => 0.5 - Math.random());
            const wrongOptions = shuffled.slice(0, 3);
            
            // Add correct answer
            const options = [...wrongOptions, {
                synonym: currentCard.synonym,
                synonym_hindi: currentCard.synonym_hindi || ''
            }];
            
            // Shuffle options
            return options.sort(() => 0.5 - Math.random());
        }

        function flipCard() {
            document.getElementById('card').classList.toggle('flipped');
        }

        function nextCard() {
            if (currentIndex < filteredCards.length - 1) {
                showCard(currentIndex + 1);
            }
        }

        function previousCard() {
            if (currentIndex > 0) {
                showCard(currentIndex - 1);
            }
        }

        function shuffleCards() {
            for (let i = filteredCards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [filteredCards[i], filteredCards[j]] = [filteredCards[j], filteredCards[i]];
            }
            isShuffled = true;
            showCard(0);
        }

        // Touch/Swipe handling
        const cardContainer = document.getElementById('card-container');
        const card = document.getElementById('card');
        
        let touchStartXPos = 0;
        let touchStartYPos = 0;
        let touchEndXPos = 0;
        let touchEndYPos = 0;
        let isSwiping = false;

        card.addEventListener('touchstart', function(e) {
            // Don't handle if touching a badge or button
            if (e.target.closest('.card-badges') || e.target.closest('button')) {
                return;
            }
            
            touchStartXPos = e.changedTouches[0].screenX;
            touchStartYPos = e.changedTouches[0].screenY;
            touchEndXPos = touchStartXPos;
            touchEndYPos = touchStartYPos;
            isSwiping = false;
        }, false);

        card.addEventListener('touchmove', function(e) {
            if (e.target.closest('.card-badges') || e.target.closest('button')) {
                return;
            }
            
            touchEndXPos = e.changedTouches[0].screenX;
            touchEndYPos = e.changedTouches[0].screenY;
            
            const xDiff = Math.abs(touchEndXPos - touchStartXPos);
            const yDiff = Math.abs(touchEndYPos - touchStartYPos);
            
            // If horizontal movement is greater than 20px, consider it a swipe
            if (xDiff > 20 || yDiff > 20) {
                isSwiping = true;
            }
        }, false);

        card.addEventListener('touchend', function(e) {
            if (e.target.closest('.card-badges') || e.target.closest('button')) {
                return;
            }
            
            const xDiff = touchEndXPos - touchStartXPos;
            const yDiff = touchEndYPos - touchStartYPos;
            const xDiffAbs = Math.abs(xDiff);
            const yDiffAbs = Math.abs(yDiff);

            // If it's a tap (not much movement)
            if (!isSwiping && xDiffAbs < 20 && yDiffAbs < 20) {
                e.preventDefault();
                flipCard();
                return;
            }

            // If it's a swipe (horizontal movement > 50px and more than vertical)
            if (isSwiping && xDiffAbs > 50 && xDiffAbs > yDiffAbs) {
                e.preventDefault();
                if (xDiff > 0) {
                    // Swipe right - previous
                    previousCard();
                } else {
                    // Swipe left - next
                    nextCard();
                }
            }
            
            isSwiping = false;
        }, false);

        // Click to flip (for desktop)
        card.addEventListener('click', function(e) {
            // Don't flip if clicking on badges or buttons
            if (e.target.closest('.card-badges') || e.target.closest('button')) {
                return;
            }
            flipCard();
        });

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextCard();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                previousCard();
            } else if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                e.preventDefault();
                flipCard();
            } else if (e.key === 'r' || e.key === 'R') {
                e.preventDefault();
                markCard('remembered');
            } else if (e.key === 'n' || e.key === 'N') {
                e.preventDefault();
                markCard('not-remembered');
            } else if (e.key === 'x' || e.key === 'X') {
                e.preventDefault();
                markCard('reset');
            }
        });

        // Quiz Functions
        function initializeQuizFilters() {
            const examCounts = {};
            const typeCounts = {};

            vocabData.items.forEach(item => {
                examCounts[item.exam_code] = (examCounts[item.exam_code] || 0) + 1;
                typeCounts[item.type] = (typeCounts[item.type] || 0) + 1;
            });

            const quizExamFiltersDiv = document.getElementById('quiz-exam-filters');
            quizExamFiltersDiv.innerHTML = '';
            const sortedExams = Object.entries(examCounts).sort((a, b) => b[1] - a[1]);
            
            sortedExams.forEach(([code, count]) => {
                const exam = vocabData.exams[code];
                if (exam) {
                    const btn = document.createElement('button');
                    btn.className = 'filter-btn';
                    btn.innerHTML = `${examIcons[code] || 'üìå'} ${exam.name.split('(')[0].trim()}<span style="opacity:0.7;font-size:0.85em;margin-left:5px">(${count})</span>`;
                    btn.onclick = () => toggleQuizExamFilter(code, btn);
                    quizExamFiltersDiv.appendChild(btn);
                }
            });

            const quizTypeFiltersDiv = document.getElementById('quiz-type-filters');
            quizTypeFiltersDiv.innerHTML = '';
            const sortedTypes = Object.entries(typeCounts).sort((a, b) => b[1] - a[1]);
            
            sortedTypes.forEach(([type, count]) => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                const displayName = typeNames[type] || type.charAt(0).toUpperCase() + type.slice(1);
                btn.innerHTML = `${displayName}<span style="opacity:0.7;font-size:0.85em;margin-left:5px">(${count})</span>`;
                btn.onclick = () => toggleQuizTypeFilter(type, btn);
                quizTypeFiltersDiv.appendChild(btn);
            });
            
            // Update question count on initialization
            updateQuizQuestionCount();
        }

        function updateQuizQuestionCount() {
            // Filter cards based on current selection
            const availableCards = vocabData.items.filter(item => {
                const examMatch = quizExamFilters.size === 0 || quizExamFilters.has(item.exam_code);
                const typeMatch = quizTypeFilters.size === 0 || quizTypeFilters.has(item.type);
                return examMatch && typeMatch && item.synonym; // Only include items with synonyms
            });

            const count = availableCards.length;
            document.getElementById('quiz-question-count').textContent = count;
            
            const startBtn = document.getElementById('start-quiz-btn');
            const hintText = document.getElementById('quiz-selection-hint');
            
            if (count === 0) {
                startBtn.disabled = true;
                startBtn.style.opacity = '0.5';
                startBtn.style.cursor = 'not-allowed';
                hintText.textContent = 'Select exam and type to see questions';
            } else {
                startBtn.disabled = false;
                startBtn.style.opacity = '1';
                startBtn.style.cursor = 'pointer';
                hintText.textContent = `Ready to test your knowledge with ${count} question${count > 1 ? 's' : ''}!`;
            }
        }

        function toggleQuizExamFilter(code, btn) {
            if (quizExamFilters.has(code)) {
                quizExamFilters.delete(code);
                btn.classList.remove('active');
            } else {
                quizExamFilters.add(code);
                btn.classList.add('active');
            }
            updateQuizQuestionCount();
        }

        function toggleQuizTypeFilter(type, btn) {
            if (quizTypeFilters.has(type)) {
                quizTypeFilters.delete(type);
                btn.classList.remove('active');
            } else {
                quizTypeFilters.add(type);
                btn.classList.add('active');
            }
            updateQuizQuestionCount();
        }

        function startQuiz() {
            // Filter cards based on selection
            quizCards = vocabData.items.filter(item => {
                const examMatch = quizExamFilters.size === 0 || quizExamFilters.has(item.exam_code);
                const typeMatch = quizTypeFilters.size === 0 || quizTypeFilters.has(item.type);
                return examMatch && typeMatch && item.synonym; // Only include items with synonyms
            });

            if (quizCards.length === 0) {
                alert('No words found with the selected filters. Please select at least one exam or type.');
                return;
            }

            // Shuffle quiz cards
            quizCards = quizCards.sort(() => 0.5 - Math.random());
            
            // Initialize quiz tracking
            quizCurrentIndex = 0;
            quizScore = 0;
            quizAnswered = 0;
            quizAnswers = [];
            quizInProgress = true;
            quizCorrectCount = 0;
            quizWrongCount = 0;
            quizSkippedCount = 0;
            
            document.getElementById('quiz-setup').style.display = 'none';
            document.getElementById('quiz-question').style.display = 'block';
            
            showQuizQuestion();
        }

        function showQuizQuestion() {
            if (quizCurrentIndex >= quizCards.length) {
                finishQuiz();
                return;
            }

            const card = quizCards[quizCurrentIndex];
            
            document.getElementById('quiz-current').textContent = quizCurrentIndex + 1;
            document.getElementById('quiz-total').textContent = quizCards.length;
            document.getElementById('quiz-score').textContent = quizScore.toFixed(1);
            document.getElementById('quiz-answered').textContent = quizAnswered;
            
            document.getElementById('quiz-word').textContent = card.word;
            document.getElementById('quiz-hint').textContent = `Select the correct ${card.type === 'antonym' ? 'antonym' : 'synonym'}`;
            
            // Generate options
            const options = generateQuizOptions(card);
            currentQuizAnswer = options.correctIndex;
            
            const optionButtons = document.querySelectorAll('.quiz-option');
            options.options.forEach((opt, idx) => {
                // Display: English word ‚Äì Hindi meaning
                const displayText = opt.hindi 
                    ? `${opt.word} ‚Äì ${opt.hindi}` 
                    : opt.word;
                optionButtons[idx].textContent = displayText;
                optionButtons[idx].className = 'quiz-option';
                optionButtons[idx].disabled = false;
            });
            
            document.getElementById('quiz-feedback').style.display = 'none';
            
            // Update button states - all buttons always visible
            const prevBtn = document.getElementById('quiz-prev-btn');
            const nextBtn = document.getElementById('quiz-next-btn');
            const skipBtn = document.getElementById('quiz-skip-btn');
            const submitBtn = document.getElementById('quiz-submit-btn');
            
            // Previous button: disabled on first question
            prevBtn.disabled = (quizCurrentIndex === 0);
            
            // Check if current question is answered
            const isAnswered = quizAnswers[quizCurrentIndex] !== undefined;
            
            // Skip button: enabled only if not answered
            skipBtn.disabled = isAnswered;
            
            // Next button: enabled only if answered and not last question
            nextBtn.disabled = !isAnswered || (quizCurrentIndex === quizCards.length - 1);
            
            // Submit button: always enabled (user can submit anytime)
            submitBtn.disabled = false;
        }

        function generateQuizOptions(currentCard) {
            // Get all possible synonyms/antonyms from other cards with their Hindi meanings
            const allOptions = vocabData.items
                .filter(item => item.synonym && item.synonym !== currentCard.synonym && item.type === currentCard.type)
                .map(item => ({ 
                    word: item.synonym, 
                    hindi: item.synonym_hindi || '' 
                }));
            
            // Shuffle and pick 3 wrong options
            const shuffled = allOptions.sort(() => 0.5 - Math.random());
            const wrongOptions = shuffled.slice(0, 3);
            
            // Add correct answer
            const correctOption = { 
                word: currentCard.synonym, 
                hindi: currentCard.synonym_hindi || '' 
            };
            const options = [...wrongOptions, correctOption];
            
            // Shuffle and remember correct index
            options.sort(() => 0.5 - Math.random());
            const correctIndex = options.findIndex(opt => opt.word === currentCard.synonym);
            
            return { options, correctIndex };
        }

        function selectAnswer(selectedIndex) {
            const optionButtons = document.querySelectorAll('.quiz-option');
            optionButtons.forEach(btn => btn.disabled = true);
            
            const feedback = document.getElementById('quiz-feedback');
            const isCorrect = selectedIndex === currentQuizAnswer;
            
            // Track answer
            quizAnswers[quizCurrentIndex] = {
                questionIndex: quizCurrentIndex,
                correct: isCorrect,
                userAnswer: selectedIndex,
                correctAnswer: currentQuizAnswer,
                skipped: false
            };
            
            if (isCorrect) {
                quizScore += 2; // +2 for correct
                quizCorrectCount++;
                optionButtons[selectedIndex].classList.add('correct');
                feedback.className = 'quiz-feedback correct';
                feedback.textContent = '‚úÖ Correct! +2 points';
            } else {
                quizScore -= 0.5; // -0.5 for wrong
                quizWrongCount++;
                optionButtons[selectedIndex].classList.add('incorrect');
                optionButtons[currentQuizAnswer].classList.add('correct');
                feedback.className = 'quiz-feedback incorrect';
                feedback.textContent = '‚ùå Incorrect! -0.5 points. Correct answer is highlighted.';
            }
            
            quizAnswered++;
            feedback.style.display = 'block';
            
            // Update button states
            const skipBtn = document.getElementById('quiz-skip-btn');
            const nextBtn = document.getElementById('quiz-next-btn');
            
            skipBtn.disabled = true; // Can't skip after answering
            
            // Enable next button if not on last question
            if (quizCurrentIndex < quizCards.length - 1) {
                nextBtn.disabled = false;
            }
            
            // Update score display
            document.getElementById('quiz-score').textContent = quizScore.toFixed(1);
            document.getElementById('quiz-answered').textContent = quizAnswered;
        }

        function skipQuestion() {
            // Track as skipped
            quizAnswers[quizCurrentIndex] = {
                questionIndex: quizCurrentIndex,
                correct: false,
                userAnswer: -1,
                correctAnswer: currentQuizAnswer,
                skipped: true
            };
            
            quizSkippedCount++;
            
            // Move to next question if available
            if (quizCurrentIndex < quizCards.length - 1) {
                quizCurrentIndex++;
                showQuizQuestion();
            } else {
                // Last question - disable skip, user must submit
                document.getElementById('quiz-skip-btn').disabled = true;
                alert('This is the last question. Please submit the quiz or go back to previous questions.');
            }
        }

        function nextQuizQuestion() {
            quizCurrentIndex++;
            showQuizQuestion();
        }

        function previousQuizQuestion() {
            if (quizCurrentIndex > 0) {
                quizCurrentIndex--;
                showQuizQuestion();
            }
        }

        function generateQuizReview() {
            const reviewList = document.getElementById('quiz-review-list');
            if (!reviewList) {
                console.error('quiz-review-list element not found');
                return;
            }
            
            let reviewHTML = '';
            
            quizCards.forEach((card, index) => {
                const answer = quizAnswers[index];
                const questionNum = index + 1;
                
                // Determine status and styling
                let statusIcon, statusText, statusColor, bgColor, userAnswerText;
                
                if (answer.skipped) {
                    statusIcon = '‚è≠Ô∏è';
                    statusText = 'Skipped';
                    statusColor = '#f39c12';
                    bgColor = '#fff3cd';
                    userAnswerText = '<em style="color: #856404;">Not answered</em>';
                } else if (answer.correct) {
                    statusIcon = '‚úÖ';
                    statusText = 'Correct';
                    statusColor = '#27ae60';
                    bgColor = '#d4edda';
                    userAnswerText = card.synonym + (card.synonym_hindi ? ` ‚Äì ${card.synonym_hindi}` : '');
                } else {
                    statusIcon = '‚ùå';
                    statusText = 'Wrong';
                    statusColor = '#e74c3c';
                    bgColor = '#f8d7da';
                    // Get the wrong answer the user selected
                    const options = generateQuizOptionsForReview(card);
                    const userSelectedOption = options.options[answer.userAnswer];
                    userAnswerText = userSelectedOption ? 
                        (userSelectedOption.word + (userSelectedOption.hindi ? ` ‚Äì ${userSelectedOption.hindi}` : '')) : 
                        'Unknown';
                }
                
                reviewHTML += `
                    <div style="background: ${bgColor}; border-left: 5px solid ${statusColor}; padding: 15px; margin-bottom: 15px; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; font-size: 1.1em; color: #333; margin-bottom: 5px;">
                                    Q${questionNum}. ${card.word}
                                </div>
                                <div style="color: #666; font-size: 0.9em; margin-bottom: 8px;">
                                    ${card.hindi || ''} ‚Ä¢ ${card.english || ''} ‚Ä¢ <em>${card.type === 'antonym' ? 'Antonym' : 'Synonym'}</em>
                                </div>
                            </div>
                            <div style="background: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; color: ${statusColor}; white-space: nowrap; margin-left: 10px;">
                                ${statusIcon} ${statusText}
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                            <div style="background: white; padding: 10px; border-radius: 5px;">
                                <div style="font-size: 0.85em; color: #666; margin-bottom: 3px;">Your Answer:</div>
                                <div style="font-weight: bold; color: ${answer.correct ? '#27ae60' : (answer.skipped ? '#856404' : '#e74c3c')};">
                                    ${userAnswerText}
                                </div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px;">
                                <div style="font-size: 0.85em; color: #666; margin-bottom: 3px;">Correct Answer:</div>
                                <div style="font-weight: bold; color: #27ae60;">
                                    ${card.synonym}${card.synonym_hindi ? ` ‚Äì ${card.synonym_hindi}` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            reviewList.innerHTML = reviewHTML;
            console.log('Quiz review generated');
        }
        
        function generateQuizOptionsForReview(currentCard) {
            // Generate the same options that were shown during the quiz
            const allOptions = vocabData.items
                .filter(item => item.synonym && item.synonym !== currentCard.synonym && item.type === currentCard.type)
                .map(item => ({ 
                    word: item.synonym, 
                    hindi: item.synonym_hindi || '' 
                }));
            
            const shuffled = allOptions.sort(() => 0.5 - Math.random());
            const wrongOptions = shuffled.slice(0, 3);
            
            const correctOption = { 
                word: currentCard.synonym, 
                hindi: currentCard.synonym_hindi || '' 
            };
            const options = [...wrongOptions, correctOption];
            
            options.sort(() => 0.5 - Math.random());
            
            return { options };
        }

        function submitQuiz() {
            try {
                console.log('Submit Quiz clicked');
                console.log('Quiz answered:', quizAnswered, 'of', quizCards.length);
                console.log('Current scores - Correct:', quizCorrectCount, 'Wrong:', quizWrongCount, 'Skipped:', quizSkippedCount);
                
                const confirmation = confirm('Are you sure you want to submit the quiz?');
                console.log('User confirmation:', confirmation);
                
                if (!confirmation) {
                    console.log('Submit cancelled by user');
                    return;
                }
                
                console.log('Marking unanswered questions as skipped...');
                // Mark all unanswered questions as skipped before finishing
                let unansweredCount = 0;
                for (let i = 0; i < quizCards.length; i++) {
                    if (quizAnswers[i] === undefined) {
                        quizAnswers[i] = {
                            questionIndex: i,
                            correct: false,
                            userAnswer: -1,
                            correctAnswer: -1,
                            skipped: true
                        };
                        quizSkippedCount++;
                        unansweredCount++;
                    }
                }
                console.log('Marked', unansweredCount, 'unanswered questions as skipped');
                
                console.log('Final scores - Correct:', quizCorrectCount, 'Wrong:', quizWrongCount, 'Skipped:', quizSkippedCount);
                console.log('Calling finishQuiz...');
                finishQuiz();
            } catch (error) {
                console.error('Error in submitQuiz:', error);
                alert('Error submitting quiz: ' + error.message);
            }
        }

        function finishQuiz() {
            try {
                console.log('finishQuiz() called');
                quizInProgress = false;
                
                // Hide quiz question section
                const quizQuestion = document.getElementById('quiz-question');
                const quizResults = document.getElementById('quiz-results');
                const quizMode = document.getElementById('quiz-mode');
                
                console.log('Quiz question element:', quizQuestion);
                console.log('Quiz results element:', quizResults);
                console.log('Quiz mode element:', quizMode);
                
                // Make sure quiz-mode is visible (remove hidden class if present)
                if (quizMode) {
                    quizMode.classList.remove('hidden');
                    console.log('Removed hidden class from quiz-mode');
                }
                
                if (!quizQuestion) {
                    console.error('quiz-question element not found!');
                }
                if (!quizResults) {
                    console.error('quiz-results element not found!');
                }
                
                if (quizQuestion) {
                    quizQuestion.style.display = 'none';
                    quizQuestion.style.setProperty('display', 'none', 'important');
                    console.log('Quiz question hidden');
                }
                if (quizResults) {
                    quizResults.style.display = 'block';
                    quizResults.style.setProperty('display', 'block', 'important');
                    console.log('Quiz results displayed with !important');
                }
                
                const percentage = Math.round((quizCorrectCount / quizCards.length) * 100);
                console.log('Percentage:', percentage);
                console.log('Final Score:', quizScore.toFixed(1));
                
                // Display results with error checking
                const finalScore = document.getElementById('quiz-final-score');
                const percentageEl = document.getElementById('quiz-percentage');
                const correctCount = document.getElementById('quiz-correct-count');
                const wrongCount = document.getElementById('quiz-wrong-count');
                const skippedCount = document.getElementById('quiz-skipped-count');
                
                if (finalScore) {
                    finalScore.textContent = quizScore.toFixed(1);
                    console.log('Final score updated');
                } else {
                    console.error('quiz-final-score element not found');
                }
                
                if (percentageEl) {
                    percentageEl.textContent = `${percentage}%`;
                    console.log('Percentage updated');
                } else {
                    console.error('quiz-percentage element not found');
                }
                
                if (correctCount) {
                    correctCount.textContent = quizCorrectCount;
                    console.log('Correct count updated:', quizCorrectCount);
                } else {
                    console.error('quiz-correct-count element not found');
                }
                
                if (wrongCount) {
                    wrongCount.textContent = quizWrongCount;
                    console.log('Wrong count updated:', quizWrongCount);
                } else {
                    console.error('quiz-wrong-count element not found');
                }
                
                if (skippedCount) {
                    skippedCount.textContent = quizSkippedCount;
                    console.log('Skipped count updated:', quizSkippedCount);
                } else {
                    console.error('quiz-skipped-count element not found');
                }
                
                // Generate detailed question review
                generateQuizReview();
                
                // Save to history
                try {
                    saveQuizToHistory();
                    console.log('Quiz saved to history');
                } catch (historyError) {
                    console.error('Error saving to history:', historyError);
                }
                
                // Scroll to top of results
                if (quizResults) {
                    setTimeout(() => {
                        quizResults.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        console.log('Scrolled to results');
                    }, 100);
                }
                
                // Double-check visibility after 200ms
                setTimeout(() => {
                    if (quizResults && window.getComputedStyle(quizResults).display === 'none') {
                        console.error('ALERT: Results still not visible! Forcing display...');
                        quizResults.style.display = 'block';
                        quizResults.style.visibility = 'visible';
                        quizResults.style.opacity = '1';
                    } else {
                        console.log('‚úì Results confirmed visible');
                    }
                }, 200);
                
                console.log('finishQuiz() completed successfully');
            } catch (error) {
                console.error('Error in finishQuiz:', error);
                alert('Error displaying results: ' + error.message + '. Check console for details.');
            }
        }

        function saveQuizToHistory() {
            const history = JSON.parse(localStorage.getItem('ssc_quiz_history') || '[]');
            
            // Get exam and type names
            const examNames = [...quizExamFilters].map(code => vocabData.exams[code]?.name || code).join(', ') || 'All Exams';
            const typeNamesStr = [...quizTypeFilters].map(type => typeNames[type] || type).join(', ') || 'All Types';
            
            // Enhance answers with card data and answer text
            const detailedAnswers = quizAnswers.map((answer, index) => {
                const card = quizCards[index];
                const options = generateQuizOptionsForReview(card);
                
                let userAnswerText = '';
                if (answer.skipped) {
                    userAnswerText = 'Not answered';
                } else {
                    const userOption = options.options[answer.userAnswer];
                    userAnswerText = userOption ? 
                        (userOption.word + (userOption.hindi ? ` ‚Äì ${userOption.hindi}` : '')) : 
                        'Unknown';
                }
                
                const correctAnswerText = card.synonym + (card.synonym_hindi ? ` ‚Äì ${card.synonym_hindi}` : '');
                
                return {
                    ...answer,
                    card: {
                        word: card.word,
                        hindi: card.hindi,
                        english: card.english,
                        type: card.type,
                        correctAnswer: card.synonym
                    },
                    userAnswerText: userAnswerText,
                    correctAnswerText: correctAnswerText
                };
            });
            
            const quizResult = {
                date: new Date().toISOString(),
                totalQuestions: quizCards.length,
                score: quizScore,
                correct: quizCorrectCount,
                wrong: quizWrongCount,
                skipped: quizSkippedCount,
                percentage: Math.round((quizCorrectCount / quizCards.length) * 100),
                exams: examNames,
                types: typeNamesStr,
                answers: detailedAnswers
            };
            
            history.unshift(quizResult); // Add to beginning
            
            // Keep only last 50 attempts
            if (history.length > 50) {
                history.pop();
            }
            
            localStorage.setItem('ssc_quiz_history', JSON.stringify(history));
        }

        function loadQuizHistory() {
            const history = JSON.parse(localStorage.getItem('ssc_quiz_history') || '[]');
            const container = document.getElementById('history-container');
            
            if (history.length === 0) {
                container.innerHTML = '<div class="no-history">üìù No quiz attempts yet. Complete a quiz to see your history here!</div>';
                return;
            }
            
            container.innerHTML = history.map((result, index) => {
                const date = new Date(result.date);
                const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                
                // Generate detailed review HTML for this quiz
                let reviewHTML = '';
                if (result.answers && result.answers.length > 0) {
                    reviewHTML = result.answers.map((answer, qIndex) => {
                        const card = answer.card || {}; // Card data stored with answer
                        const questionNum = qIndex + 1;
                        
                        let statusIcon, statusText, statusColor, bgColor, userAnswerText;
                        
                        if (answer.skipped) {
                            statusIcon = '‚è≠Ô∏è';
                            statusText = 'Skipped';
                            statusColor = '#f39c12';
                            bgColor = '#fff3cd';
                            userAnswerText = '<em style="color: #856404;">Not answered</em>';
                        } else if (answer.correct) {
                            statusIcon = '‚úÖ';
                            statusText = 'Correct';
                            statusColor = '#27ae60';
                            bgColor = '#d4edda';
                            userAnswerText = answer.userAnswerText || 'Correct';
                        } else {
                            statusIcon = '‚ùå';
                            statusText = 'Wrong';
                            statusColor = '#e74c3c';
                            bgColor = '#f8d7da';
                            userAnswerText = answer.userAnswerText || 'Wrong';
                        }
                        
                        return `
                            <div style="background: ${bgColor}; border-left: 5px solid ${statusColor}; padding: 12px; margin-bottom: 10px; border-radius: 6px; font-size: 0.9em;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold; color: #333;">
                                            Q${questionNum}. ${card.word || 'Question ' + questionNum}
                                        </div>
                                        ${card.hindi || card.english ? `<div style="color: #666; font-size: 0.85em; margin-top: 3px;">${card.hindi || ''} ${card.english ? '‚Ä¢ ' + card.english : ''}</div>` : ''}
                                    </div>
                                    <div style="background: white; padding: 5px 10px; border-radius: 15px; font-weight: bold; color: ${statusColor}; font-size: 0.85em; white-space: nowrap; margin-left: 10px;">
                                        ${statusIcon} ${statusText}
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px;">
                                    <div style="background: white; padding: 8px; border-radius: 4px;">
                                        <div style="font-size: 0.8em; color: #666; margin-bottom: 2px;">Your Answer:</div>
                                        <div style="font-weight: bold; color: ${answer.correct ? '#27ae60' : (answer.skipped ? '#856404' : '#e74c3c')}; font-size: 0.9em;">
                                            ${userAnswerText}
                                        </div>
                                    </div>
                                    <div style="background: white; padding: 8px; border-radius: 4px;">
                                        <div style="font-size: 0.8em; color: #666; margin-bottom: 2px;">Correct Answer:</div>
                                        <div style="font-weight: bold; color: #27ae60; font-size: 0.9em;">
                                            ${answer.correctAnswerText || card.correctAnswer || 'N/A'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                return `
                    <div class="history-item">
                        <div class="history-header">
                            <div>
                                <div style="font-weight: bold; font-size: 1.1em; color: #667eea;">${result.exams}</div>
                                <div style="font-size: 0.9em; color: #7f8c8d; margin-top: 5px;">${result.types}</div>
                            </div>
                            <div class="history-score">${result.score.toFixed(1)}</div>
                        </div>
                        <div class="history-date">üìÖ ${dateStr}</div>
                        <div class="history-details">
                            <div class="history-stat">
                                <div class="history-stat-value stat-correct">${result.correct}</div>
                                <div class="history-stat-label">Correct</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value stat-wrong">${result.wrong}</div>
                                <div class="history-stat-label">Wrong</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value stat-skipped">${result.skipped}</div>
                                <div class="history-stat-label">Skipped</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value" style="color: #667eea;">${result.percentage}%</div>
                                <div class="history-stat-label">Accuracy</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value" style="color: #2c3e50;">${result.totalQuestions}</div>
                                <div class="history-stat-label">Questions</div>
                            </div>
                        </div>
                        ${reviewHTML ? `
                            <button class="btn" onclick="toggleHistoryDetails(${index})" 
                                    style="background: #667eea; color: white; padding: 10px 20px; margin-top: 15px; font-size: 0.9em; width: 100%;">
                                üìä View Detailed Analysis
                            </button>
                            <div id="history-details-${index}" style="display: none; margin-top: 15px; max-height: 500px; overflow-y: auto;">
                                <h4 style="color: #667eea; margin-bottom: 15px;">Question by Question Review</h4>
                                ${reviewHTML}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        function toggleHistoryDetails(index) {
            const detailsDiv = document.getElementById(`history-details-${index}`);
            const button = event.target;
            
            if (detailsDiv.style.display === 'none') {
                detailsDiv.style.display = 'block';
                button.textContent = 'üîº Hide Detailed Analysis';
            } else {
                detailsDiv.style.display = 'none';
                button.textContent = 'üìä View Detailed Analysis';
            }
        }

        function clearQuizHistory() {
            if (!confirm('Are you sure you want to clear all quiz history? This cannot be undone.')) {
                return;
            }
            
            localStorage.removeItem('ssc_quiz_history');
            loadQuizHistory();
        }

        function restartQuiz() {
            quizExamFilters.clear();
            quizTypeFilters.clear();
            quizInProgress = false;
            document.getElementById('quiz-results').style.display = 'none';
            document.getElementById('quiz-setup').style.display = 'block';
            initializeQuizFilters();
        }


        // Initialize
        loadProgress(); // Load saved progress from localStorage
        initializeFilters();
    </script>
</body>
</html>
